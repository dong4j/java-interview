---
sidebar: auto
title: String ç›¸å…³
date: 2019-03-05 15:39
author: dong4j
tags:
- String
---

::: tip
å­—ç¬¦ä¸²æ“ä½œåœ¨ç¼–ç¨‹ä¸­æˆ‘ä»¬ä¼šå¤§é‡ä½¿ç”¨,æ‰€ä»¥æŒæ¡å­—ç¬¦ä¸²ç›¸å…³ç±»å¯¹æˆ‘ä»¬æ¥è¯´å¾ˆé‡è¦.
Javaä¸ºæˆ‘ä»¬æä¾›äº† 3 ç§æ“ä½œå­—ç¬¦ä¸²çš„ç±».ç”±äº `String` ç±»çš„ç‰¹æ®Š,æœ‰å¿…è¦äº†è§£ä¸€ä¸‹Javaè¿è¡Œæ—¶å†…å­˜çš„æ¦‚å¿µ,æ‰èƒ½æ›´å¥½çš„ç†è§£å­—ç¬¦ä¸²ç›¸å…³ç±»çš„åº•å±‚æ“ä½œ.
:::

<!-- more -->

## Javaä¸­å†…å­˜çŸ¥è¯†

[ğŸ‘ˆ **ç›¸å…³é¢è¯•é¢˜**](./README.md#_51-ğŸ‘‰-string-stringbuffer-stringbuilder-çš„åŒºåˆ«)

åœ¨åå°„ä¸­æˆ‘ä»¬å­¦åˆ°,å¯¹äºæ¯ä¸€ä¸ªè¢«JVMåŠ è½½åˆ°å†…å­˜ä¸­çš„ç±»,éƒ½ä¼šåœ¨æ–¹æ³•åŒºä¿å­˜ä¸€ä»½è¿™ä¸ªç±»çš„ä¿¡æ¯;
åŒ…æ‹¬:

- ç±»çš„åŸºæœ¬ä¿¡æ¯
	- ç±»çš„å…¨å,ç›´æ¥çˆ¶ç±»çš„å…¨æ°‘
	- è¯¥ç±»çš„æ¥å£
	- è¯¥ç±»çš„è®¿é—®ä¿®é¥°ç¬¦
- ç±»çš„è¯¦ç»†ä¿¡æ¯
	-  è¿è¡Œæ—¶å¸¸é‡æ±   --> å­—ç¬¦ä¸²,å¸¸é‡,ç±»åå’Œæ–¹æ³•åå¸¸é‡.
	-  å­—æ®µä¿¡æ¯  --> å­—æ®µå,ç±»å‹,ä¿®é¥°ç¬¦
	-  æ–¹æ³•ä¿¡æ¯  --> æ–¹æ³•å,è¿”å›å€¼ç±»å‹,å‚æ•°ç±»å‹,ä¿®é¥°ç¬¦,å¼‚å¸¸,æ–¹æ³•çš„å­—èŠ‚ç 
	-  é™æ€å˜é‡  --> åœ¨æ–¹æ³•åŒºä¸­çš„é™æ€åŒºä¿å­˜è¢«ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«çš„å˜é‡å’Œé™æ€å¿«
	-  åˆ°ç±»classloaderçš„å¼•ç”¨
	-  åˆ°ç±»classçš„å¼•ç”¨   JVMä¸ºæ¯ä¸€ä¸ªè¢«åŠ è½½åˆ°å†…å­˜çš„ç±»å‹åˆ›å»ºä¸€ä¸ªclasså®ä¾‹,ç”¨å®ä¾‹ä»£è¡¨è¿™ä¸ªè¢«åŠ è½½çš„ç±»

ç”±æ­¤å¼•å‡ºåå°„çš„æ¦‚å¿µ:
åœ¨åŠ è½½ç±»çš„æ—¶å€™,åŠ å…¥æ–¹æ³•åŒºçš„æ‰€æœ‰ä¿¡æ¯,æœ€åéƒ½ä¼šå½±åŸClassç±»çš„å®ä¾‹,ä»£è¡¨è¿™ä¸ªè¢«åŠ è½½çš„ç±».æ–¹æ³•å»ä¸­çš„æ‰€æœ‰ä¿¡æ¯,éƒ½æ˜¯å¯ä»¥é€šè¿‡è¿™ä¸ªClassç±»å¯¹è±¡åå°„å¾—åˆ°.

### Javaè¿è¡Œæ—¶æ•°æ®åŒºçš„åˆ’åˆ†

- ç¨‹åºè®¡æ•°å™¨(Program Counter Register)
- æœ¬åœ°æ–¹æ³•æ ˆ (Native Method Stacks)
- Javaè™šæ‹Ÿæœºæ ˆ (Java Visual Machine Stacks)
	- å±€éƒ¨å˜é‡,å¼•ç”¨åç­‰ä¿å­˜åœ¨æ ˆä¸­
	- ä¸å…±äº«,æ¯ä¸ªçº¿ç¨‹ä¼šæœ‰å±äºè‡ªå·±çš„æ ˆ
- Javaå † (Java Heap)
	- è¢«`new` å…³é”®å­—æ‰€åˆ›å»ºå‡ºæ¥çš„æ‰€æœ‰å®ä¾‹å¯¹è±¡
	- è¢«å„ä¸ªçº¿ç¨‹å…±äº«
- æ–¹æ³•åŒº (Method Area)
	- è¢«å„ä¸ªçº¿ç¨‹å…±äº«
	- å­˜å‚¨ç±»ä¿¡æ¯,å¸¸é‡,é™æ€å˜é‡,ä»¥åŠç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®

## Stringç±»

### Stringç±»çš„å£°æ˜

`public final class String extends Object implements Serializable, Comparable<String>, CharSequence`
Stringç±»å£°æ˜ä¸­,æ˜¯è¢«finalä¿®é¥°,æ‰€ä»¥å¯ä»¥çœ‹å‡ºå­—ç¬¦ä¸²çš„å†…å®¹æ˜¯ä¸å¯å˜çš„,è€Œä¸”æ˜¯ä¸èƒ½è¢«ç»§æ‰¿çš„ç±»;ä¸€æ—¦ä¸€ä¸ªStringå¯¹è±¡è¢«åˆ›å»º,åŒ…å«åœ¨è¿™ä¸ªå¯¹è±¡ä¸­çš„å†…å®¹æ˜¯ä¸å¯æ”¹å˜çš„,ç›´è‡³è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶;
å…¶å®Stringç±»åœ¨åº•å±‚å°±æ˜¯é€šè¿‡å­—ç¬¦æ•°ç»„æ¥å®ç°çš„,å¯¹äºæ•°ç»„,æˆ‘ä»¬çŸ¥é“å®ƒçš„é•¿åº¦ä¸å¯å˜,è‡ªç„¶è€Œç„¶çš„Stringç±»ä¹Ÿä¸å¯å˜äº†.

### Stringç±»åœ¨å†…å­˜ä¸­çš„è¡¨ç°å½¢å¼

1. éšå¼åˆ›å»º
`String str1 = "helloworld";`
	- åœ¨æ ˆä¸­å£°æ˜ä¸€ä¸ªstr1çš„å¼•ç”¨,ç„¶ååœ¨**å¸¸é‡åŒº**ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰"helloworld"è¿™ä¸ªå¸¸é‡;
		- å¦‚æœæœ‰,åˆ™ç›´æ¥è¿”å›ä¸€ä¸ªå¼•ç”¨ç»™str1;
		- å¦‚æœæ²¡æœ‰,åˆ™å…ˆåœ¨å¸¸é‡åŒºä¸­åˆ›å»º 'helloworld"å­—ç¬¦ä¸²,ç„¶åè¿”å›å¼•ç”¨;
2. æ˜¾å¼åˆ›å»º
`String str2 = new String("å¼ ä¸‰");`
	- åœ¨æ ˆä¸­å£°æ˜ä¸€ä¸ªstr2çš„å¼•ç”¨,ç„¶ååœ¨**å †**ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡,é‡Œé¢çš„å€¼æ˜¯"å¼ ä¸‰";
	- è¿”å›è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨;
	

ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡ å¯¹è±¡è°ƒç”¨Stringç±»çš„æ–¹æ³•,ä½†æ˜¯é—®é¢˜æ¥äº†, `"helloworld".toCharArray()` è¿™å¥ä»£ç ä¸ä¼šæŠ¥é”™,è¯´æ˜`"helloworld"`å¯ä»¥å½“ä¸€ä¸ªå¯¹è±¡æ¥ä½¿ç”¨,é‚£ä¹ˆå †ä¸­çš„`"helloworld"`å’Œå¸¸é‡æ± ä¸­çš„`"helloworld"`æ˜¯ä»€ä¹ˆå…³ç³»å‘¢?
é‚£å°±è®©æˆ‘ä»¬æ¥è¯´è¯´ä»–ä»¬2ä¸ªä¹‹é—´ä¸å¾—ä¸è¯´çš„æ•…äº‹.

```java
// helloworldåœ¨å¸¸é‡åŒºä¸­
String str1 = "helloworld";
// å¯¹è±¡åœ¨å †ä¸­
String str2 = new String("helloworld");
```

![](imgs/3207817b.png)

å¯¹äºä¸Šé¢2è¡Œä»£ç ,ä¼šåœ¨ä¸åŒçš„åŒºåŸŸåˆ›å»º2ä¸ªå¯¹è±¡.

- æ‰§è¡Œç¬¬ä¸€è¡Œæ—¶,
	- åœ¨æ ˆä¸­å£°æ˜ä¸€ä¸ªstr1çš„å¼•ç”¨,ç„¶ååœ¨**å¸¸é‡åŒº**ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰"helloworld"è¿™ä¸ªå¸¸é‡;
		- å¦‚æœæœ‰,åˆ™ç›´æ¥è¿”å›ä¸€ä¸ªå¼•ç”¨ç»™str1;
		- å¦‚æœæ²¡æœ‰,åˆ™å…ˆåœ¨å¸¸é‡åŒºä¸­åˆ›å»º 'helloworld"å­—ç¬¦ä¸²,ç„¶åè¿”å›å¼•ç”¨;
- æ‰§è¡Œç¬¬äºŒè¡Œæ—¶,ä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡,è¿™ä¸ªå¯¹è±¡çš„å€¼ä¸º`"helloworld"`,ç„¶åå†å»å¸¸é‡åŒºå‚çœ‹æ˜¯å¦æœ‰`"helloworld"`è¿™ä¸ªå¸¸é‡å­—ç¬¦ä¸²;
	- å¦‚æœæ²¡æœ‰,å°±åœ¨å¸¸é‡åŒºåˆ›å»ºä¸€ä¸ª`"helloworld"`å­—ç¬¦ä¸²å¸¸é‡,ç„¶åä¸è¿™ä¸ªå¯¹è±¡å…³è”;
	- å¦‚æœæœ‰,åˆ™æŠŠå¸¸é‡åŒºçš„`"helloworld"`å¼•ç”¨åŒå †ä¸­å¯¹è±¡å…³è”èµ·æ¥;

æ— è®ºå¦‚ä½•,åªè¦ç”¨newå…³é”®å­—å®ä¾‹åŒ–ä¸€ä¸ªä¸ªå­—ç¬¦ä¸²å¯¹è±¡,éƒ½ä¼šåœ¨å †ä¸­åˆ›å»ºå®ä¾‹,è€Œéšå¼åˆ›å»ºçš„è¯åˆ™ä¸ä¸€å®šæ–°å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡;

é‚£ä¹ˆé—®é¢˜æ¥äº†
`String str2 = new String("helloworld");`ä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºå‡ ä¸ªå¯¹è±¡,å‡ ä¸ªå¼•ç”¨?
ç­”æ¡ˆæ˜¯3ä¸ªå¯¹è±¡,2ä¸ªå¼•ç”¨;

- å¯¹è±¡ 
	- Stringè¿™ä¸ªç±»çš„å¯¹è±¡(åå°„æœºåˆ¶)
	- Stringå®ä¾‹åŒ–å¯¹è±¡ (å †ä¸­)
	- å¸¸é‡åŒºä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡
- å¼•ç”¨
	- å †ä¸­å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨
	- å¸¸é‡åŒºä¸­å­—ç¬¦ä¸²çš„å¼•ç”¨

æˆ‘ä»¬å¯ä»¥é€šè¿‡Stringç±»çš„intern()æ–¹æ³•æ¥å®éªŒä¸€ä¸‹
å½“è°ƒç”¨ intern æ–¹æ³•æ—¶, å¦‚æœå¸¸é‡æ± ä¸­å·²ç»åŒ…å«ä¸€ä¸ªç­‰äºæ­¤ String å¯¹è±¡çš„å­—ç¬¦ä¸²(ç”¨ equals(Object) æ–¹æ³•ç¡®å®š), åˆ™è¿”å›æ± ä¸­çš„å­—ç¬¦ä¸².å¦åˆ™, å°†æ­¤ String å¯¹è±¡æ·»åŠ åˆ°æ± ä¸­, å¹¶è¿”å›æ­¤ String å¯¹è±¡çš„å¼•ç”¨

```java
public static void main (String[] args) {
    String s1 = "osEye.net";
    String s2 = new String ("osEye.net");
    if (s1 == s2) {
        System.out.println ("å­—ç¬¦ä¸²å¼•ç”¨s1å’Œå­—ç¬¦ä¸²å¼•ç”¨s2æ‰€æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡");
    } else {
        System.out.println ("å­—ç¬¦ä¸²å¼•ç”¨s1å’Œå­—ç¬¦ä¸²å¼•ç”¨s2æ‰€æŒ‡å‘çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡");
        if (s1.intern() == s2.intern() ) {
            System.out.println ("å­—ç¬¦ä¸²å¼•ç”¨s1å’Œå­—ç¬¦ä¸²å¼•ç”¨s2åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è”ç³»çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡");
        } else {
            System.out.println ("å­—ç¬¦ä¸²å¼•ç”¨s1å’Œå­—ç¬¦ä¸²å¼•ç”¨s2åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è”ç³»çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡");
        }
    }
}
```
>è¾“å‡º
>å­—ç¬¦ä¸²å¼•ç”¨s1å’Œå­—ç¬¦ä¸²å¼•ç”¨s2æ‰€æŒ‡å‘çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡
>å­—ç¬¦ä¸²å¼•ç”¨s1å’Œå­—ç¬¦ä¸²å¼•ç”¨s2åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è”ç³»çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡

è¿™ç§æœºåˆ¶å¾ˆå¥½çš„å®ç°äº†å…±äº«å’ŒèŠ‚çœå†…å­˜ç©ºé—´,å½“æˆ‘éœ€è¦ä½¿ç”¨å­—ç¬¦ä¸²æ—¶,å¦‚æœå†…å­˜ä¸­æœ‰è¿™ä¸ªå­—ç¬¦ä¸²äº†,å°±ä¸ä¼šå†åˆ›å»º,è€Œæ˜¯ç›´æ¥è¿”å›å·²å­˜åœ¨çš„å­—ç¬¦ä¸²çš„å¼•ç”¨.

å¯¹äº
`String s = "hello" + "world"` çš„åˆ†æ
åœ¨JDK1.5ä¹‹å‰,è¿™æ¡è¯­å¥ä¼šç”Ÿæˆ2ä¸ªå­—ç¬¦ä¸²å¸¸é‡,
ä½†æ˜¯åœ¨JDK1.5ä¹‹å,ç¼–è¯‘å™¨å¯¹æ­¤åšå‡ºäº†ä¼˜åŒ–,æœ€ç»ˆåªæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡"helloworld"å­˜å…¥å¸¸é‡åŒºä¸­.
è¿™ç§ä¼˜åŒ–å°±æ˜¯é»˜è®¤çš„è°ƒç”¨äº†StringBuilder.append()æ–¹æ³•;

### Stringç±»çš„ä½¿ç”¨
ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„å­—ç¬¦ä¸²æ“ä½œçš„æ–¹æ³•

- `charAt(int index)`  è¿”å›æŒ‡å®šç´¢å¼•å¤„çš„ char å€¼.
- `equals(Object anObject)` å°†æ­¤å­—ç¬¦ä¸²ä¸æŒ‡å®šçš„å¯¹è±¡æ¯”è¾ƒ.
- `equalsIgnoreCase(String anotherString)`  å°†æ­¤ String ä¸å¦ä¸€ä¸ª String æ¯”è¾ƒ, ä¸è€ƒè™‘å¤§å°å†™
- `indexOf(int ch)`  è¿”å›æŒ‡å®šå­—ç¬¦åœ¨æ­¤å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°å¤„çš„ç´¢å¼•.
- `length()` è¿”å›æ­¤å­—ç¬¦ä¸²çš„é•¿åº¦.
- `matches(String regex)` å‘ŠçŸ¥æ­¤å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼.
- `replace(char oldChar, char newChar)` è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸², å®ƒæ˜¯é€šè¿‡ç”¨ newChar æ›¿æ¢æ­¤å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ‰€æœ‰ oldChar å¾—åˆ°çš„.
- `split(String regex)`  æ ¹æ®ç»™å®šæ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ‹†åˆ†æ­¤å­—ç¬¦ä¸².
- `substring(int beginIndex)` è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸², å®ƒæ˜¯æ­¤å­—ç¬¦ä¸²çš„ä¸€ä¸ªå­å­—ç¬¦ä¸².
- `trim()` è¿”å›å­—ç¬¦ä¸²çš„å‰¯æœ¬, å¿½ç•¥å‰å¯¼ç©ºç™½å’Œå°¾éƒ¨ç©ºç™½.
- `toCharArray()` å°†æ­¤å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ–°çš„å­—ç¬¦æ•°ç»„.

åˆ¤æ–­æ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸²
s != null && s != "";
**æ³¨æ„**åˆ¤æ–­ä¸èƒ½ä¸ºç©ºå¿…é¡»æ”¾åœ¨å‰é¢,å› ä¸ºå¯èƒ½ä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸


## ä¸å¯å˜æ€§

ç®€å•çš„æ¥è¯´:String ç±»ä¸­ä½¿ç”¨ final å…³é”®å­—å­—ç¬¦æ•°ç»„ä¿å­˜å­—ç¬¦ä¸², `privateã€€finalã€€charã€€value[]`, æ‰€ä»¥ String å¯¹è±¡æ˜¯ä¸å¯å˜çš„.è€ŒStringBuilder ä¸ StringBuffer éƒ½ç»§æ‰¿è‡ª AbstractStringBuilder ç±», åœ¨ AbstractStringBuilder ä¸­ä¹Ÿæ˜¯ä½¿ç”¨å­—ç¬¦æ•°ç»„ä¿å­˜å­—ç¬¦ä¸²`char[] value` ä½†æ˜¯æ²¡æœ‰ç”¨ final å…³é”®å­—ä¿®é¥°, æ‰€ä»¥è¿™ä¸¤ç§å¯¹è±¡éƒ½æ˜¯å¯å˜çš„.

StringBuilder ä¸ StringBuffer çš„æ„é€ æ–¹æ³•éƒ½æ˜¯è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•ä¹Ÿå°±æ˜¯ AbstractStringBuilder å®ç°çš„, å¤§å®¶å¯ä»¥è‡ªè¡ŒæŸ¥é˜…æºç .

AbstractStringBuilder.java

```java
abstract class AbstractStringBuilder implements Appendable, CharSequence {
    char[] value;
    int count;
    AbstractStringBuilder() {
    }
    AbstractStringBuilder(int capacity) {
        value = new char[capacity];
    }
```

## çº¿ç¨‹å®‰å…¨æ€§

String ä¸­çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„, ä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºå¸¸é‡, çº¿ç¨‹å®‰å…¨.AbstractStringBuilder æ˜¯ StringBuilder ä¸ StringBuffer çš„å…¬å…±çˆ¶ç±», å®šä¹‰äº†ä¸€äº›å­—ç¬¦ä¸²çš„åŸºæœ¬æ“ä½œ, å¦‚ expandCapacityã€appendã€insertã€indexOf ç­‰å…¬å…±æ–¹æ³•. StringBuffer å¯¹æ–¹æ³•åŠ äº†åŒæ­¥é”æˆ–è€…å¯¹è°ƒç”¨çš„æ–¹æ³•åŠ äº†åŒæ­¥é”, æ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„. StringBuilder å¹¶æ²¡æœ‰å¯¹æ–¹æ³•è¿›è¡ŒåŠ åŒæ­¥é”, æ‰€ä»¥æ˜¯éçº¿ç¨‹å®‰å…¨çš„.
ã€€ã€€

**æ€§èƒ½**

æ¯æ¬¡å¯¹ String ç±»å‹è¿›è¡Œæ”¹å˜çš„æ—¶å€™, éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ String å¯¹è±¡, ç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„ String å¯¹è±¡. StringBuffer æ¯æ¬¡éƒ½ä¼šå¯¹ StringBuffer å¯¹è±¡æœ¬èº«è¿›è¡Œæ“ä½œ, è€Œä¸æ˜¯ç”Ÿæˆæ–°çš„å¯¹è±¡å¹¶æ”¹å˜å¯¹è±¡å¼•ç”¨.ç›¸åŒæƒ…å†µä¸‹ä½¿ç”¨ StirngBuilder ç›¸æ¯”ä½¿ç”¨ StringBuffer ä»…èƒ½è·å¾— 10%~15% å·¦å³çš„æ€§èƒ½æå‡, ä½†å´è¦å†’å¤šçº¿ç¨‹ä¸å®‰å…¨çš„é£é™©.

**å¯¹äºä¸‰è€…ä½¿ç”¨çš„æ€»ç»“:** 
1. æ“ä½œå°‘é‡çš„æ•°æ® = String
2. å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ® = StringBuilder
3. å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ® = StringBuffer

####  String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„
ç®€å•æ¥è¯´å°±æ˜¯ String ç±»åˆ©ç”¨äº† final ä¿®é¥°çš„ char ç±»å‹æ•°ç»„å­˜å‚¨å­—ç¬¦, æºç å¦‚ä¸‹å›¾æ‰€ä»¥:

```java
/** The value is used for character storage. */
private final char value[];
```

####  String çœŸçš„æ˜¯ä¸å¯å˜çš„å—ï¼Ÿ
æˆ‘è§‰å¾—å¦‚æœåˆ«äººé—®è¿™ä¸ªé—®é¢˜çš„è¯, å›ç­”ä¸å¯å˜å°±å¯ä»¥äº†.
ä¸‹é¢åªæ˜¯ç»™å¤§å®¶çœ‹ä¸¤ä¸ªæœ‰ä»£è¡¨æ€§çš„ä¾‹å­:

**1) String ä¸å¯å˜ä½†ä¸ä»£è¡¨å¼•ç”¨ä¸å¯ä»¥å˜**

```java
String str = "Hello";
str = str + " World";
System.out.println("str = " + str);
```
ç»“æœ:
```
str = Hello World
```
è§£æ:

å®é™…ä¸Š, åŸæ¥ String çš„å†…å®¹æ˜¯ä¸å˜çš„, åªæ˜¯ str ç”±åŸæ¥æŒ‡å‘ "Hello" çš„å†…å­˜åœ°å€è½¬ä¸ºæŒ‡å‘ "Hello World" çš„å†…å­˜åœ°å€è€Œå·², ä¹Ÿå°±æ˜¯è¯´å¤šå¼€è¾Ÿäº†ä¸€å—å†…å­˜åŒºåŸŸç»™ "Hello World" å­—ç¬¦ä¸².

**2) é€šè¿‡åå°„æ˜¯å¯ä»¥ä¿®æ”¹æ‰€è°“çš„â€œä¸å¯å˜â€å¯¹è±¡**

```java
// åˆ›å»ºå­—ç¬¦ä¸²"Hello World",  å¹¶èµ‹ç»™å¼•ç”¨s
String s = "Hello World";
System.out.println("s = " + s); // Hello World
// è·å–Stringç±»ä¸­çš„valueå­—æ®µ
Field valueFieldOfString = String.class.getDeclaredField("value");
// æ”¹å˜valueå±æ€§çš„è®¿é—®æƒé™
valueFieldOfString.setAccessible(true);
// è·å–så¯¹è±¡ä¸Šçš„valueå±æ€§çš„å€¼
char[] value = (char[]) valueFieldOfString.get(s);
// æ”¹å˜valueæ‰€å¼•ç”¨çš„æ•°ç»„ä¸­çš„ç¬¬5ä¸ªå­—ç¬¦
value[5] = '_';
System.out.println("s = " + s); // Hello_World
```

ç»“æœ:

```
s = Hello World
s = Hello_World
```

è§£æ:

ç”¨åå°„å¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜,  ç„¶ååå°„å‡º  String å¯¹è±¡ä¸­çš„ value å±æ€§,  è¿›è€Œæ”¹å˜é€šè¿‡è·å¾—çš„ value å¼•ç”¨æ”¹å˜æ•°ç»„çš„ç»“æ„.ä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šè¿™ä¹ˆåš, è¿™é‡Œåªæ˜¯ç®€å•æä¸€ä¸‹æœ‰è¿™ä¸ªä¸œè¥¿.

---------

## StringBuffer ç±»

- ä¸ºäº†èƒ½è®© String é‡Œé¢çš„å†…å®¹èƒ½å¤Ÿæ”¹å˜,æ‰€ä»¥ç”¨ StringBuffer ç±»å°è£…äº† String ç±»;
- ä½¿ç”¨ append() æ–¹æ³•å‘å­—ç¬¦ä¸²æœ«å°¾æ·»åŠ å­—ç¬¦ä¸²,
- çº¿ç¨‹å®‰å…¨çš„,æ•ˆç‡æ¯” String é«˜
- ç»å¸¸ä½¿ç”¨åœ¨å­—ç¬¦ä¸²æ‹¼æ¥çš„åœ°æ–¹,æ¯”å¦‚è¯´æ•°æ®åº“è¯­å¥

## StringBuilder ç±»

### ä¸ StringBuffer ç±»çš„å¯¹æ¯”

```java
// StringBuffer ç±»çš„ append() æ–¹æ³•
public synchronized StringBuffer append(String str){
	super.append(str);
	return this;
}

// StringBuilder ç±»çš„ append() æ–¹æ³•
public StringBuilder append(String str){
	super.append(str);
	return this;
}
```
StringBuilder æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„,æ•ˆç‡æ¯” StringBuffer é«˜,åœ¨ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„æ—¶å€™ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ StringBuilder.

## 3 ç§å­—ç¬¦ä¸²å¯¹æ¯”

- å¼‚åŒç‚¹
	- éƒ½æ˜¯ `final` ç±»,éƒ½ä¸å…è®¸è¢«ç»§æ‰¿;
	- `String` é•¿åº¦ä¸å¯æ”¹å˜,å…¶ä»– 2 ç§é•¿åº¦å¯å˜;
	- `StringBuffer` æ˜¯çº¿ç¨‹å®‰å…¨çš„,ä½†æ˜¯æ•ˆç‡ä½, `StringBuilder` çº¿ç¨‹ä¸å®‰å…¨ä½†æ˜¯æ•ˆç‡é«˜
	- æ€§èƒ½: `StringBuilder > StringBuffer > String`
	- String è¦†ç›–äº† equals æ–¹æ³•å’Œ hashCode æ–¹æ³•, è€Œ StringBuffer,StringBuilder æ²¡æœ‰è¦†ç›– equals æ–¹æ³•å’Œ hashCodeæ–¹æ³•, æ‰€ä»¥å°† StringBuffer,StringBuilder å¯¹è±¡å­˜å‚¨è¿› Java é›†åˆç±»ä¸­æ—¶ä¼šå‡ºç°é—®é¢˜.

- ä½¿ç”¨ç­–ç•¥
	- åŸºæœ¬åŸåˆ™:
		- å¦‚æœæ“ä½œå°‘é‡çš„æ•°æ®,ç”¨ `String` ;
		- å•çº¿ç¨‹æ“ä½œå¤§é‡æ•°æ®,ä½¿ç”¨ `StringBuilder` ;
		- å¤šçº¿ç¨‹æ“ä½œå¤§é‡æ•°æ®,ä½¿ç”¨ `StringBuffer` ;
	- ä¸å»ºè®®ä½¿ç”¨ `String` ç±»çš„ "+" è¿›è¡Œé¢‘ç¹çš„å­—ç¬¦ä¸²æ‹¼æ¥,è€Œæ˜¯ä½¿ç”¨ `StringBuilder` æˆ–è€… `StringBuffer` ç±»;
	- `StringBuilder` ä¸€èˆ¬ä½¿ç”¨åœ¨æ–¹æ³•å†…éƒ¨æ¥å®Œæˆç±»ä¼¼"+"åŠŸèƒ½, å› ä¸ºçº¿ç¨‹å®‰å…¨,ç”¨å®Œåä¸¢å¼ƒ;
	- `StringBuffer` ä¸»è¦ç”¨åœ¨å…¨å±€å˜é‡ä¸­;
	- ç›¸åŒæƒ…å†µä¸‹ä½¿ç”¨  `StirngBuilder`  ç›¸æ¯”ä½¿ç”¨ ` StringBuffer`  ä»…èƒ½è·å¾— 10%~15% å·¦å³çš„æ€§èƒ½æå‡, ä½†å´è¦å†’å¤šçº¿ç¨‹ä¸å®‰å…¨çš„é£é™©. è€Œåœ¨ç°å®çš„æ¨¡å—åŒ–ç¼–ç¨‹ä¸­, è´Ÿè´£æŸä¸€æ¨¡å—çš„ç¨‹åºå‘˜ä¸ä¸€å®šèƒ½æ¸…æ™°åœ°åˆ¤æ–­è¯¥æ¨¡å—æ˜¯å¦ä¼šæ”¾å…¥å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸­è¿è¡Œ, å› æ­¤:é™¤éç¡®å®šç³»ç»Ÿçš„ç“¶é¢ˆæ˜¯åœ¨  `StringBuffer`  ä¸Š, å¹¶ä¸”ç¡®å®šä½ çš„æ¨¡å—ä¸ä¼šè¿è¡Œåœ¨å¤šçº¿ç¨‹æ¨¡å¼ä¸‹, æ‰å¯ä»¥é‡‡ç”¨ `StringBuilder` ;å¦åˆ™è¿˜æ˜¯ç”¨ `StringBuffer` .
	
### æ€ä¹ˆå‘ Set ä¸­å­˜å…¥ç›¸åŒçš„å­—ç¬¦ä¸²

ç”±äº StringBuilder å’Œ StringBuffer éƒ½æœªé‡å†™ equals() å’Œ hashCode(), å› æ­¤å¯ä»¥ä½¿ç”¨ StringBuilder æˆ– StringBuffer åˆ›å»ºç›¸åŒçš„å­—ç¬¦ä¸²å­˜å…¥ Set ä¸­

```java
@Test
public void test3(){
    StringBuffer stringBuffer1 = new StringBuffer("123");
    StringBuffer stringBuffer2 = new StringBuffer("123");
    StringBuilder stringBuilder1 = new StringBuilder("123");
    StringBuilder stringBuilder2 = new StringBuilder("123");
    Set<CharSequence> stringBuffers = new HashSet<>();
    stringBuffers.add(stringBuffer1);
    stringBuffers.add(stringBuffer2);
    stringBuffers.add(stringBuilder1);
    stringBuffers.add(stringBuilder2);
    System.out.println(stringBuffers.size()); // 4
}
```

### åœ¨ Java è™šæ‹Ÿæœºä¸­, å­—ç¬¦ä¸²å¸¸é‡åˆ°åº•å­˜æ”¾åœ¨å“ªé‡Œ

å‰é˜µå­å’Œæœ‹å‹è®¨è®ºä¸€ä¸ªé—®é¢˜: å­—ç¬¦ä¸²å¸¸é‡å½’å¸¸é‡æ± ç®¡ç†, é‚£æ¯”å¦‚ `String str = "abc";`  "abc" è¿™ä¸ªå¯¹è±¡æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„å“ªä¸ªä½ç½®, æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è¿˜æ˜¯å †ï¼Ÿ

è¿™å¥ä»£ç çš„ abc å½“ç„¶åœ¨å¸¸é‡æ± ä¸­, åªæœ‰ `new String("abc")` è¿™ä¸ªå¯¹è±¡æ‰åœ¨å †ä¸­åˆ›å»ºâ€œ, ä»–ä»¬å¤§æ¦‚æ˜¯è¿™ä¹ˆå›ç­”.

"abc" è¿™ä¸ªä¸œè¥¿, æ˜¯æ”¾åœ¨å¸¸é‡æ± ä¸­, è¿™ä¸ªç­”æ¡ˆæ˜¯é”™è¯¯çš„.

**å­—ç¬¦ä¸² "abc" çš„æœ¬ä½“ã€å®ä¾‹, åº”è¯¥æ˜¯å­˜åœ¨äºJavaå †ä¸­.**

å¯èƒ½è¿˜çœŸçš„æœ‰éƒ¨åˆ†åŒå­¦å¯¹è¿™ä¸ªçŸ¥è¯†ç‚¹ä¸ç†Ÿæ‚‰, ä»Šå¤©å’Œå¤§å®¶èŠèŠå­—ç¬¦ä¸²è¿™ä¸ªé—®é¢˜ ~

åˆå­¦ Java æ—¶, å­¦åˆ°å­—ç¬¦ä¸²è¿™ä¸€éƒ¨åˆ†, æœ‰ä¸€æ®µä»£ç 

```java
String str1 = "hello";
String str2 = new String("hello"); 
```

> ä¹¦ä¸Šçš„è§£é‡Šæ˜¯:æ‰§è¡Œç¬¬ä¸€è¡Œçš„æ—¶å€™, å·²ç»æŠŠ "hello" å­—ç¬¦ä¸²æ”¾åˆ°äº†å¸¸é‡æ± ä¸­, æ‰§è¡Œç¬¬äºŒè¡Œä»£ç æ—¶, ä¼šå°†å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨çš„ "hello" å¤åˆ¶ä¸€ä»½åˆ°å †å†…å­˜ä¸­, åˆ›å»ºä¸€ä¸ªçš„æ–°çš„ String å¯¹è±¡.è™½ç„¶å€¼ä¸€æ ·, ä½†ä»–ä»¬æ˜¯ä¸åŒçš„å¯¹è±¡.

å½“æ—¶çœ‹å®Œè¿™ä¸ªè§£é‡Š, æˆ‘äº§ç”Ÿäº†å¾ˆå¤šç–‘æƒ‘.å› ä¸ºåœ¨æ­¤ä¹‹å‰å·²ç»çŸ¥é“å­—ç¬¦ä¸²çš„åº•å±‚æ˜¯ char æ•°ç»„å®ç°çš„.æˆ‘å¾ˆç–‘æƒ‘:

* ä»– copy ä¸€ä»½è¿‡å», æ˜¯ copy äº† char æ•°ç»„?
* è¿˜æ˜¯ copy æ•´ä¸ª String å¯¹è±¡ï¼Ÿ
* "hello" è¿™ä¸ªå¯¹è±¡å®ä¾‹çœŸçš„å­˜æ”¾åœ¨å¸¸é‡æ± ä¸­ï¼Ÿ

å½“æ—¶åœ¨ç½‘ä¸Šæœäº†ä¸€äº›æ–‡ç« å’Œç­”æ¡ˆ, å„æœ‰è¯´è¾, å¤§éƒ¨åˆ†å›ç­”éƒ½æ˜¯ "str" è¿™ä¸ªå¯¹è±¡åœ¨å¸¸é‡æ± ä¸­, ä½†ä¹Ÿæœ‰è®¤ä¸ºå­—ç¬¦ä¸²å¸¸é‡å®ä¾‹(æˆ–å«å¯¹è±¡)æ˜¯åœ¨å †ä¸­åˆ›å»º, åªæ˜¯å°†å…¶å¼•ç”¨æ”¾åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­, äº¤ç»™å¸¸é‡æ± ç®¡ç†.

## Java å†…å­˜åŒºåŸŸ â€” è¿è¡Œæ—¶æ•°æ®åŒº

ç†æ¸…è¿™ä¸ªé—®é¢˜å‰, éœ€è¦æ¢³ç†ä¸€ä¸‹å‰ç½®çŸ¥è¯†.

ä»ä¸€ä¸ªç»å…¸çš„ç¤ºæ„å›¾è®²èµ·, ä»¥ hotspot è™šæ‹Ÿæœºä¸ºä¾‹, æ­¤å†…å­˜æ¨¡å‹éœ€å»ºç«‹åœ¨ JDK1.7 ä¹‹å‰çš„ç‰ˆæœ¬æ¥è®¨è®º, JDK1.7 ä¹‹åæœ‰æ‰€æ”¹å˜, ä½†æ˜¯åŸç†è¿˜æ˜¯ä¸€æ ·çš„.

![](imgs/23d2a9e2.png)

Javaè™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºé‚£ä¸€éƒ¨åˆ†, ç®€å•æ¦‚æ‹¬ä¸€ä¸‹å…¶ä¸­å„ä¸ªåŒºåŸŸçš„åŒºåˆ«:

* **è™šæ‹Ÿæœºæ ˆ**:çº¿ç¨‹ç§æœ‰, ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒ, å³æ¯æ¡çº¿ç¨‹éƒ½ä¸€ä¸ªç‹¬ç«‹çš„æ ˆ(VM Stack).æ¯ä¸ªæ–¹æ³•æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§, ä¹Ÿå°±æ˜¯è¯´, å½“æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº†å¤šä¸ªæ–¹æ³•æ—¶, å°±ä¼šæœ‰ä¸€ä¸ªæ ˆ, æ ˆä¸­æœ‰å¤šä¸ªæ ˆå¸§.

* **æœ¬åœ°æ–¹æ³•æ ˆ**:çº¿ç¨‹ç§æœ‰

* **ç¨‹åºè®¡æ•°å™¨**:çº¿ç¨‹ç§æœ‰

* **å †Heap**:çº¿ç¨‹å…±äº«, æ˜¯ Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—, åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»º.æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹, å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜.**åœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­çš„æè¿°æ˜¯:æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é….**Â *(åŸæ–‡:The heap is the runtime data area from which memory for all class instances and arrays is allocated)*ä½†æœ‰ç‰¹æ®Šæƒ…å†µ, éšç€ JIT ç¼–è¯‘å™¨çš„å‘å±•, é€ƒé€¸åˆ†æå’Œæ ‡é‡æ›¿æ¢æŠ€æœ¯çš„é€æ¸æˆç†Ÿ, å¯¹è±¡ä¹Ÿå¯ä»¥åœ¨**æ ˆä¸Š**åˆ†é….å¦å¤–, è™½è¯´å †æ˜¯çº¿ç¨‹å…±äº«, ä½†å…¶ä¸­ä¹Ÿå¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒº*(Thread Local Allocation Buffer, TLAB)*.

* **æ–¹æ³•åŒº**:çº¿ç¨‹å…±äº«, å®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„**ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®**.

## Java çš„ä¸‰ç§å¸¸é‡æ± 

æ­¤å¤–, Java æœ‰ä¸‰ç§å¸¸é‡æ± , å³**å­—ç¬¦ä¸²å¸¸é‡æ± (åˆå«å…¨å±€å­—ç¬¦ä¸²æ± )ã€classæ–‡ä»¶å¸¸é‡æ± ã€è¿è¡Œæ—¶å¸¸é‡æ± **.

![](imgs/20f05abd.png)

**1. å­—ç¬¦ä¸²å¸¸é‡æ± (ä¹Ÿå«å…¨å±€å­—ç¬¦ä¸²æ± ã€string poolã€string literal pool)**

å­—ç¬¦ä¸²å¸¸é‡æ± åœ¨æ¯ä¸ªVMä¸­åªæœ‰ä¸€ä»½, ä»–åœ¨å†…å­˜ä¸­çš„ä½ç½®å¦‚å›¾, çº¢è‰²ç®­å¤´æ‰€æŒ‡å‘çš„åŒºåŸŸ Interned Strings

**2. è¿è¡Œæ—¶å¸¸é‡æ± (runtime constant pool)**

å½“ç¨‹åºè¿è¡Œåˆ°æŸä¸ªç±»æ—¶, class æ–‡ä»¶ä¸­çš„ä¿¡æ¯å°±ä¼šè¢«è§£æåˆ°å†…å­˜çš„**æ–¹æ³•åŒº**é‡Œçš„**è¿è¡Œæ—¶å¸¸é‡æ± **ä¸­. çœ‹å›¾å¯æ¸…æ™°æ„ŸçŸ¥åˆ°æ¯ä¸€ä¸ªç±»è¢«åŠ è½½è¿›æ¥éƒ½ä¼šäº§ç”Ÿä¸€ä¸ª**è¿è¡Œæ—¶å¸¸é‡æ± **, ç”±æ­¤å¯çŸ¥, **æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªè¿è¡Œæ—¶å¸¸é‡æ± **. å®ƒåœ¨å†…å­˜ä¸­çš„ä½ç½®å¦‚å›¾, è“è‰²ç®­å¤´æ‰€æŒ‡å‘çš„åŒºåŸŸ, æ–¹æ³•åŒºä¸­çš„ Class Date ä¸­çš„è¿è¡Œæ—¶å¸¸é‡æ± (Run-Time Constant Pool)

![](imgs/1239b92a.png)

**3. class æ–‡ä»¶å¸¸é‡æ± (class constant pool)**

class å¸¸é‡æ± æ˜¯åœ¨ç¼–è¯‘åæ¯ä¸ªclassæ–‡ä»¶éƒ½æœ‰çš„, class æ–‡ä»¶ä¸­é™¤äº†åŒ…å«ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–, è¿˜æœ‰ä¸€é¡¹ä¿¡æ¯å°±æ˜¯Â ***å¸¸é‡æ± ****(constant pool table)*, ç”¨äºå­˜æ”¾ç¼–è¯‘å™¨ç”Ÿæˆçš„å„ç§å­—é¢é‡(Literal)å’Œç¬¦å·å¼•ç”¨(Symbolic References).*å­—é¢é‡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å¸¸é‡æ¦‚å¿µ, å¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€è¢«å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰.*ä»–åœ¨ class æ–‡ä»¶ä¸­çš„ä½ç½®å¦‚ä¸Šå›¾æ‰€ç¤º, Constant Pool ä¸­.

## ä¸ªäººç†è§£

```java
public static void main(String[] args) {
	String str = "hello";
}
```

å›åˆ°ä¸€å¼€å§‹è¯´åˆ°çš„è¿™å¥ä»£ç , å¯ä»¥æ¥æ€»ç»“ä¸€ä¸‹å®ƒçš„æ‰§è¡Œè¿‡ç¨‹äº†.

1. é¦–å…ˆ, å­—é¢é‡ "hello" åœ¨ç¼–è¯‘æœŸ, å°±ä¼šè¢«è®°å½•åœ¨ classæ–‡ä»¶çš„Â **class å¸¸é‡æ± **ä¸­.
2. è€Œå½“ classæ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜ä¸­å, JVM å°±ä¼šå°† class å¸¸é‡æ± ä¸­çš„**å¤§éƒ¨åˆ†å†…å®¹å­˜æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ± **ä¸­, ä½†æ˜¯**å­—ç¬¦ä¸² "hello" çš„æœ¬ä½“**(å¯¹è±¡)å’Œå…¶ä»–æ‰€æœ‰å¯¹è±¡ä¸€æ ·, æ˜¯**ä¼šåœ¨å †ä¸­åˆ›å»º**, **å†å°†å¼•ç”¨æ”¾åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± **, ä¹Ÿå°±æ˜¯å›¾ä¸€çš„ Interned Stringsçš„ä½ç½®.(RednaxelaFX çš„æ–‡ç« é‡Œ, æµ‹è¯•ç»“æœæ˜¯åœ¨æ–°ç”Ÿä»£çš„EdenåŒº.ä½†å› ä¸ºä¸€ç›´æœ‰ä¸€ä¸ªå¼•ç”¨é©»ç•™åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± , æ‰€ä»¥ä¸ä¼šè¢«GCæ¸…ç†æ‰)
3. è€Œåˆ°äº† `String str = "hello"` è¿™æ­¥, JVM ä¼šå»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ‰¾, å¦‚æœæ‰¾åˆ°äº†, JVM ä¼šåœ¨æ ˆä¸­çš„å±€éƒ¨å˜é‡è¡¨é‡Œåˆ›å»ºstr å˜é‡, ç„¶åæŠŠå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„(hello å¯¹è±¡çš„)**å¼•ç”¨**èµ‹å€¼ç»™ str å˜é‡.

åœ¨ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹è¿™æœ¬ä¹¦ä¸­ä¹Ÿæœ‰å­—ç¬¦ä¸²ç›¸å…³çš„è§£é‡Š, ä¸¾å…¶ä¸­å‡ ä¸ªä¾‹å­:

**ä¾‹å­1**

> (åŸæ–‡)è¿è¡Œæ—¶å¸¸é‡æ± (Runtime Constant Pool)æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†.Classæ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–, è¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± (Constant Pool Table), ç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨, **è¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾.**

æœ€åä¸€å¥æè¿°ä¸å¤ªå‡†ç¡®, ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å¹¶ä¸æ˜¯å…¨éƒ¨è¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­.**å­—ç¬¦ä¸²å­—é¢é‡å°±ä¸è¿›å…¥è¿è¡Œæ—¶å¸¸é‡æ± **, è€Œæ˜¯**åœ¨å †ä¸­åˆ›å»ºäº†å¯¹è±¡**, **å†å°†å¼•ç”¨é©»ç•™åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­.**

**ä¾‹å­2**

```java
//ä»£ç æ¸…å•2-7&emsp;String.intern()è¿”å›å¼•ç”¨çš„æµ‹è¯•

public class RuntimeConstantPoolOOM{

	public static void main(String[]args){
		String str1 = new StringBuilder("è®¡ç®—æœº").append("è½¯ä»¶").toString();
		System.out.println(str1.intern() == str1);
		String str2 = new StringBuilder("ja").append("va").toString();
		System.out.println(str2.intern() == str2);
	}
}
```

::: tip åŸæ–‡
è¿™æ®µä»£ç åœ¨JDK 1.6ä¸­è¿è¡Œ, ä¼šå¾—åˆ°ä¸¤ä¸ªfalse, è€Œåœ¨JDK 1.7ä¸­è¿è¡Œ, ä¼šå¾—åˆ°ä¸€ä¸ªtrueå’Œä¸€ä¸ªfalse.
äº§ç”Ÿå·®å¼‚çš„åŸå› æ˜¯: åœ¨JDK 1.6ä¸­, intern() æ–¹æ³•ä¼šæŠŠé¦–æ¬¡é‡åˆ°çš„å­—ç¬¦ä¸²å®ä¾‹å¤åˆ¶åˆ°æ°¸ä¹…ä»£ä¸­, è¿”å›çš„ä¹Ÿæ˜¯æ°¸ä¹…ä»£ä¸­è¿™ä¸ªå­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨, è€Œç”± StringBuilder åˆ›å»ºçš„å­—ç¬¦ä¸²å®ä¾‹åœ¨ Java å †ä¸Š, æ‰€ä»¥å¿…ç„¶ä¸æ˜¯åŒä¸€ä¸ªå¼•ç”¨, å°†è¿”å›false.è€ŒJDK 1.7(ä»¥åŠéƒ¨åˆ†å…¶ä»–è™šæ‹Ÿæœº, ä¾‹å¦‚ JRockit) çš„ intern() å®ç°ä¸ä¼šå†å¤åˆ¶å®ä¾‹, åªæ˜¯åœ¨å¸¸é‡æ± ä¸­è®°å½•é¦–æ¬¡å‡ºç°çš„å®ä¾‹å¼•ç”¨, å› æ­¤ intern() è¿”å›çš„å¼•ç”¨å’Œç”± StringBuilder åˆ›å»ºçš„é‚£ä¸ªå­—ç¬¦ä¸²å®ä¾‹æ˜¯åŒä¸€ä¸ª.å¯¹ str2 æ¯”è¾ƒè¿”å› false æ˜¯å› ä¸º â€œjavaâ€ è¿™ä¸ªå­—ç¬¦ä¸²åœ¨æ‰§è¡Œ StringBuilder.toString() ä¹‹å‰å·²ç»å‡ºç°è¿‡, å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»æœ‰å®ƒçš„å¼•ç”¨äº†, ä¸ç¬¦åˆâ€œé¦–æ¬¡å‡ºç°â€çš„åŸåˆ™, è€Œâ€œè®¡ç®—æœºè½¯ä»¶â€è¿™ä¸ªå­—ç¬¦ä¸²åˆ™æ˜¯é¦–æ¬¡å‡ºç°çš„, å› æ­¤è¿”å›true.
:::

åŸæ–‡è§£é‡Šä¹Ÿä¸å¤ªå‡†ç¡®, æˆ‘è§‰å¾—åœ¨ JDK 1.6ä¸­, intern() å¹¶ä¸ä¼šæŠŠé¦–æ¬¡é‡åˆ°çš„å­—ç¬¦ä¸²å®ä¾‹å¤åˆ¶åˆ°æ°¸ä¹…ä»£ä¸­, è€Œæ˜¯ä¼šå°†å®ä¾‹å†å¤åˆ¶ä¸€ä»½åˆ°å †(heap)ä¸­, ç„¶åå°†å…¶å¼•ç”¨æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è¿›è¡Œç®¡ç†, æ‰€ä»¥æ­¤ä»£ç è¿”å› false.è€ŒJDK1.7ä¸­çš„ intern()ä¸ä¼šå†å¤åˆ¶å®ä¾‹, ç›´æ¥å°†é¦–æ¬¡é‡åˆ°çš„æ­¤å­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨, æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± , äºæ˜¯è¿”å› true. å…³äºæ­¤è§‚ç‚¹, è¿˜æ²¡çœ‹åˆ°å¤§ç¥æ–‡ç« å®é”¤, æ¬¢è¿è®¨è®º.

æœ€åå†å»¶ä¼¸ä¸€ç‚¹, å¤§å®¶éƒ½çŸ¥é“, å­—ç¬¦ä¸²çš„ value æ˜¯ final ä¿®é¥°çš„ char æ•°ç»„, é‚£ä¹ˆä»¥ä¸‹è¿™æ®µä»£ç :

```java
// private final char value[];
String str1 = "hello world";
String str2 = new String("hello world");
String str3 = new String("hello world");
```

str1ã€str2ã€str3 ä¸‰ä¸ªå˜é‡æ‰€æŒ‡å‘çš„éƒ½æ˜¯ä¸åŒçš„å¯¹è±¡.(str1 != str2 != str3)

é‚£ä¹ˆ, è¿™ä¸‰ä¸ªå¯¹è±¡é‡Œçš„ char æ•°ç»„æ˜¯å¦æ˜¯åŒä¸€ä¸ªæ•°ç»„ï¼Ÿç›¸ä¿¡å¤§å®¶éƒ½æœ‰ç­”æ¡ˆäº†.

* * *

æ­¤æ–‡æ‰€è®¨è®ºçš„ Java å†…å­˜æ¨¡å‹æ˜¯å»ºç«‹åœ¨ JDK1.7 ä¹‹å‰. JDK 7 å¼€å§‹ Hotspot è™šæ‹ŸæœºæŠŠå­—ç¬¦ä¸²å¸¸é‡æ±  (Interned Stringä½ç½®) ä»æ°¸ä¹…ä»£(PermGen) æŒªåˆ° Heap å †, JDK 8 åˆå½»åº•å–æ¶ˆ PermGen, æŠŠè¯¸å¦‚ class ä¹‹ç±»çš„å…ƒæ•°æ®éƒ½æŒªåˆ° GC å †ä¹‹å¤–ç®¡ç†. ä½†ä¸ç®¡æ€æ ·, åŸºæœ¬åŸç†è¿˜æ˜¯ä¸å˜çš„, å­—é¢é‡ "hello" ç­‰ä¾æ—§ä¸æ˜¯æ”¾åœ¨ Interned String ä¸­.

* * *

**æ¨èæ–‡ç« :**

* [è¯·åˆ«å†æ‹¿ â€œString s = new String("xyz"); åˆ›å»ºäº†å¤šå°‘ä¸ªStringå®ä¾‹â€ æ¥é¢è¯•äº†å§](https://link.juejin.im/?target=https%3A%2F%2Frednaxelafx.iteye.com%2Fblog%2F774673)
* [å€Ÿ HSDB æ¥æ¢ç´¢HotSpot VMçš„è¿è¡Œæ—¶æ•°æ®](https://link.juejin.im/?target=https%3A%2F%2Frednaxelafx.iteye.com%2Fblog%2F1847971)Â *ä½œè€…:RednaxelaFX, æ›¾ä¸ºã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ææ¨èè¯­*
* [Java ç”¨è¿™æ ·çš„æ–¹å¼ç”Ÿæˆå­—ç¬¦ä¸²: String str = "Hello" , åˆ°åº•æœ‰æ²¡æœ‰åœ¨å †ä¸­åˆ›å»ºå¯¹è±¡ï¼Ÿ](https://link.juejin.im/?target=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F29884421%2Fanswer%2F113785601)Â - èƒ–å›çš„å›ç­” - çŸ¥ä¹

[ğŸ‘ˆ **ç›¸å…³é¢è¯•é¢˜**](./README.md#_51-ğŸ‘‰-string-stringbuffer-stringbuilder-çš„åŒºåˆ«)